@using MinecraftJarScanner.Lib.Models
@inject ScannerService ScannerService
@inject NavigationManager NavMan

<div class="hstack gap-3 mb-3">
    <!-- Back -->
    <a class="btn btn-primary shadow-sm" href="/">Back to overview</a>

    <!-- Controls -->
    <div class="btn-group shadow-sm ms-auto" role="group">
        @if (Scanner.IsRunning)
        {
            <button class="btn btn-warning" type="button" @onclick="@(async () => await Scanner.CancelAsync())">Cancel</button>
        }
        else
        {
            <button class="btn btn-success" type="button" @onclick="@(async () => await Scanner.StartAsync())">Start scan</button>
        }
        <button class="btn btn-danger" @onclick="DeleteAsync">Delete scanner</button>
    </div>
</div>

<div class="bg-body border rounded shadow-sm p-3 mb-4">

    <!-- Status -->
    <div class="fs-5 mb-2">Status: <span class="badge text-bg-@StatusHelper.GetColorName(Scanner.Status)">@Scanner.Status</span></div>

    <!-- Path -->
    <div class="input-group mb-3">
        <span class="input-group-text">Path</span>
        <input type="text" class="form-control" placeholder="" aria-label="Directory path" @bind-value="@Scanner.ScannerPath" disabled="@Scanner.IsRunning">
    </div>

</div>

<!-- Status message -->
<div class="p-2">
    @if (!string.IsNullOrWhiteSpace(Scanner.StatusMessage))
    {
        <div class="alert alert-@(StatusHelper.GetColorName(Scanner.Status))" role="alert">
            @Scanner.StatusMessage
        </div>
    }
</div>

<hr />

<!-- Output -->
<h2 class="fs-3">Output</h2>
<div class="p-2">
    <div class="accordion" id="accordion-section">

        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    Log
                </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordion-section">
                <div class="accordion-body">
                    
                    @foreach (IScannerResult result in Scanner.Results)
                    {
                        <div>Content</div>
                    }

                </div>
            </div>
        </div>


    </div>
</div>

@code
{
    [Parameter, EditorRequired]
    public required Scanner Scanner { get; init; }

    private async Task StartAsync()
    {
        await Scanner.StartAsync();
    }

    private async Task CancelAsync()
    {
        await Scanner.CancelAsync();
    }

    private async Task DeleteAsync()
    {
        await ScannerService.DeleteScannerAsync(Scanner);
        NavMan.NavigateTo("/");
    }
}
